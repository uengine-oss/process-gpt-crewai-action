# CrewAI Action ì„œë²„

CrewAIë¥¼ í™œìš©í•œ ìì—°ì–´ ì²˜ë¦¬ ì•¡ì…˜ ì„œë²„ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìš”ì²­ì„ ë°›ì•„ CrewAI ì—ì´ì „íŠ¸ë“¤ì´ í˜‘ì—…í•˜ì—¬ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

## ğŸ“Š ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CrewAI Action ì„œë²„ íë¦„ë„                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Process-GPT   â”‚â”€â”€â”€â–¶â”‚ CrewAI Action    â”‚â”€â”€â”€â–¶â”‚   CrewAI        â”‚
â”‚   Agent SDK     â”‚    â”‚   Server         â”‚    â”‚   Factory       â”‚
â”‚   (í´ë§)        â”‚    â”‚                  â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â–¼
         â”‚                       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚              â”‚  Dynamic       â”‚
         â”‚                       â”‚              â”‚  Prompt        â”‚
         â”‚                       â”‚              â”‚  Generator     â”‚
         â”‚                       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â–¼                       â”‚
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
         â”‚              â”‚ CrewAI Action    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚ Executor         â”‚
         â”‚              â”‚                  â”‚
         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â”‚                       â–¼
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Event Queue    â”‚
                        â”‚   (ê²°ê³¼ ë°˜í™˜)     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ íŒŒì¼ êµ¬ì¡° ë° ì—­í• 

### ğŸš€ ë©”ì¸ ì‹¤í–‰ íŒŒì¼ë“¤

#### `crewai_action_server.py` - ì„œë²„ ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
- **ì—­í• **: ë©”ì¸ ì„œë²„ ì‹¤í–‰ íŒŒì¼
- **ê¸°ëŠ¥**: 
  - ProcessGPT Agent SDKë¥¼ ì‚¬ìš©í•œ í´ë§ ê¸°ë°˜ ì„œë²„
  - 5ì´ˆ ê°„ê²©ìœ¼ë¡œ ìƒˆ ì‘ì—… í™•ì¸
  - CrewAI Action Executorë¥¼ ìƒì„±í•˜ê³  ì—°ê²°
- **ì‹¤í–‰**: `python crewai_action_server.py`

#### `crewai_action_executor.py` - ì‘ì—… ì‹¤í–‰ê¸°
- **ì—­í• **: ì‹¤ì œ CrewAI ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” í•µì‹¬ ì»´í¬ë„ŒíŠ¸
- **ê¸°ëŠ¥**:
  - Contextì—ì„œ ì‚¬ìš©ì ìš”ì²­ê³¼ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
  - CrewAI í¬ë£¨ ìƒì„± ë° ì‹¤í–‰
  - ê²°ê³¼ë¥¼ ì´ë²¤íŠ¸ íë¡œ ë°˜í™˜
  - ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹…

### ğŸ­ í¬ë£¨ ê´€ë¦¬ íŒŒì¼ë“¤

#### `crew_factory.py` - í¬ë£¨ ìƒì„± íŒ©í† ë¦¬
- **ì—­í• **: CrewAI ì—ì´ì „íŠ¸ì™€ í¬ë£¨ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±
- **ì£¼ìš” í´ë˜ìŠ¤/í•¨ìˆ˜**:
  - `AgentWithProfile`: í”„ë¡œí•„ ì •ë³´ë¥¼ ê°€ì§„ Agent ì„œë¸Œí´ë˜ìŠ¤
  - `create_dynamic_agent()`: ì—ì´ì „íŠ¸ ì •ë³´ë¡œ Agent ê°ì²´ ìƒì„±
  - `create_user_task()`: ì‚¬ìš©ì ìš”ì²­ ê¸°ë°˜ Task ìƒì„±
  - `create_crew()`: ìµœì¢… í¬ë£¨ ì¡°ë¦½ ë° ë°˜í™˜

#### `prompt_generator.py` - ë™ì  í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸°
- **ì—­í• **: LLMì„ í™œìš©í•œ ë™ì  Task í”„ë¡¬í”„íŠ¸ ìƒì„±
- **ì£¼ìš” ê¸°ëŠ¥**:
  - `DynamicPromptGenerator`: LLM ê¸°ë°˜ í”„ë¡¬í”„íŠ¸ ìµœì í™”
  - í•™ìŠµëœ ì§€ì‹(Mem0) í†µí•©
  - í”¼ë“œë°± ìš°ì„ ìˆœìœ„ ì²˜ë¦¬
  - í¼ í˜•ì‹ì— ë§ëŠ” ê²°ê³¼ êµ¬ì¡° ìƒì„±

#### `utils.py` - ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
- **ì—­í• **: CrewAI ê²°ê³¼ ì²˜ë¦¬ ë° ë³€í™˜
- **ì£¼ìš” ê¸°ëŠ¥**:
  - `convert_crew_output()`: CrewAI ì¶œë ¥ì„ í‘œì¤€ JSON í˜•ì‹ìœ¼ë¡œ ë³€í™˜
  - ì½”ë“œ ë¸”ë¡ ì œê±° ë° JSON íŒŒì‹±
  - í¼ ë°ì´í„° ì •ê·œí™”

## ğŸ”„ ì‹¤í–‰ íë¦„ ìƒì„¸

### 1ë‹¨ê³„: ì„œë²„ ì‹œì‘
```bash
python crewai_action_server.py
```
- ProcessGPT Agent SDK í´ë§ ì„œë²„ ì‹œì‘
- 5ì´ˆë§ˆë‹¤ ìƒˆ ì‘ì—… í™•ì¸

### 2ë‹¨ê³„: ì‘ì—… ìˆ˜ì‹  ë° íŒŒì‹±
```python
# crewai_action_executor.pyì—ì„œ
query = context.get_user_input()           # ì‚¬ìš©ì ìš”ì²­
context_data = context.get_context_data()  # ë©”íƒ€ë°ì´í„°
```

### 3ë‹¨ê³„: ì—ì´ì „íŠ¸ ë° í¬ë£¨ ìƒì„±
```python
# crew_factory.pyì—ì„œ
agents = []  # ì—ì´ì „íŠ¸ë“¤ ìƒì„±
for agent_info in agent_info_list:
    agent = create_dynamic_agent(agent_info, tools)
    agents.append(agent)

crew = Crew(agents=agents, tasks=[task], process=Process.sequential)
```

### 4ë‹¨ê³„: ë™ì  í”„ë¡¬í”„íŠ¸ ìƒì„±
```python
# prompt_generator.pyì—ì„œ
prompt_generator = DynamicPromptGenerator(llm=agent._llm_raw)
description, expected_output = prompt_generator.generate_task_prompt(
    task_instructions=query,
    agent_info=agent_info,
    form_types=form_types,
    # ... ê¸°íƒ€ íŒŒë¼ë¯¸í„°ë“¤
)
```

### 5ë‹¨ê³„: CrewAI ì‹¤í–‰
```python
result = crew.kickoff()  # ì‹¤ì œ CrewAI ì‹¤í–‰
```

### 6ë‹¨ê³„: ê²°ê³¼ ì²˜ë¦¬ ë° ë°˜í™˜
```python
# utils.pyì—ì„œ
pure_form_data, wrapped_result, original_wo_form = convert_crew_output(result, form_id)

# ì´ë²¤íŠ¸ íë¡œ ê²°ê³¼ ì „ì†¡
event_queue.enqueue_event(TaskStatusUpdateEvent(...))
event_queue.enqueue_event(TaskArtifactUpdateEvent(...))
```

## ğŸ›  ì„¤ì¹˜ ë° ì‹¤í–‰

### 1. í™˜ê²½ ì„¤ì •
```bash
# ê°€ìƒí™˜ê²½ ìƒì„±
uv venv

# ì˜ì¡´ì„± ì„¤ì¹˜
uv pip install -r requirements.txt

# ê°€ìƒí™˜ê²½ í™œì„±í™” (Windows)
source .venv/Scripts/activate

# ê°€ìƒí™˜ê²½ ë¹„í™œì„±í™”
deactivate
```

### 2. í™˜ê²½ë³€ìˆ˜ ì„¤ì •
`.env` íŒŒì¼ì— í•„ìš”í•œ í™˜ê²½ë³€ìˆ˜ ì„¤ì •:
```bash
# OpenAI API ì„¤ì •
OPENAI_API_KEY=your_openai_api_key_here

# LANGSMITH ì„¤ì • (ì„ íƒì‚¬í•­)
LANGSMITH_API_KEY=your_langsmith_api_key_here
LANGSMITH_PROJECT=crewai-process-gpt
LANGSMITH_ENDPOINT=https://api.smith.langchain.com
```

### 3. ì„œë²„ ì‹¤í–‰
```bash
python crewai_action_server.py
```

### 4. ë¡œê·¸ í™•ì¸
```bash
# ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸
kubectl logs -f crewai-action-deployment-<pod-id>

# ë¡œê·¸ íŒŒì¼ë¡œ ì¶œë ¥
python crewai_action_server.py > output.log 2>&1
```

### 5. í—¬ìŠ¤ ì²´í¬ ë° ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸

- í—¬ìŠ¤ ì—”ë“œí¬ì¸íŠ¸: `GET /health` â†’ `{ "status": "ok" }`
- ë¡œì»¬ í™•ì¸:
```bash
curl -f http://localhost:8000/health
```
- ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸:
```bash
python smoke_test.py              # ê¸°ë³¸: http://localhost:8000
SMOKE_BASE_URL=http://svc:8000 python smoke_test.py
```

### 6. Kubernetes í”„ë¡œë¸Œ ì˜ˆì‹œ

```yaml
readinessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 5
  periodSeconds: 5
livenessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 15
  periodSeconds: 10
```

### 7. ë°°í¬ í›„ ë¡¤ì•„ì›ƒ í™•ì¸

```bash
kubectl rollout status deploy/crewai-action-deployment -n dev --timeout=180s
```

## ğŸ”§ ì£¼ìš” íŠ¹ì§•

### âœ… ì¥ì 
- **ë™ì  ì—ì´ì „íŠ¸ ìƒì„±**: ëŸ°íƒ€ì„ì— ì—ì´ì „íŠ¸ êµ¬ì„± ë³€ê²½ ê°€ëŠ¥
- **ì§€ëŠ¥í˜• í”„ë¡¬í”„íŠ¸**: LLM ê¸°ë°˜ ë™ì  í”„ë¡¬í”„íŠ¸ ìµœì í™”
- **í•™ìŠµ ì§€ì‹ í†µí•©**: Mem0ë¥¼ í†µí•œ ê³¼ê±° ê²½í—˜ í™œìš©
- **í”¼ë“œë°± ìš°ì„  ì²˜ë¦¬**: ì‚¬ìš©ì í”¼ë“œë°±ì„ ìµœìš°ì„ ìœ¼ë¡œ ë°˜ì˜
- **ê²¬ê³ í•œ ì—ëŸ¬ ì²˜ë¦¬**: ì¬ì‹œë„ ë¡œì§ê³¼ ìƒì„¸í•œ ë¡œê¹…

### ğŸ¯ í•µì‹¬ ê¸°ëŠ¥
- **í´ë§ ê¸°ë°˜ ì„œë²„**: ProcessGPT Agent SDKì™€ ì—°ë™
- **ë©€í‹° ì—ì´ì „íŠ¸ í˜‘ì—…**: ì—¬ëŸ¬ AI ì—ì´ì „íŠ¸ì˜ í˜‘ì—… ì‘ì—…
- **í¼ ë°ì´í„° ì²˜ë¦¬**: êµ¬ì¡°í™”ëœ ê²°ê³¼ ë°ì´í„° ìƒì„±
- **ì´ë²¤íŠ¸ ê¸°ë°˜ í†µì‹ **: ë¹„ë™ê¸° ê²°ê³¼ ì „ë‹¬

## ğŸ“ ê°œë°œ ì°¸ê³ ì‚¬í•­

### ì—ëŸ¬ ì²˜ë¦¬
- ëª¨ë“  ì£¼ìš” í•¨ìˆ˜ì—ì„œ ì˜ˆì™¸ ë°œìƒ ì‹œ ìƒì„¸ ë¡œê¹…
- CrewAI ì‹¤í–‰ ì‹¤íŒ¨ ì‹œ ì›ì¸ ë¶„ì„ ì •ë³´ ì œê³µ
- ì¬ì‹œë„ ë¡œì§ìœ¼ë¡œ ì¼ì‹œì  ì˜¤ë¥˜ ëŒ€ì‘

### ë¡œê¹…
- êµ¬ì¡°í™”ëœ ë¡œê¹…ìœ¼ë¡œ ë””ë²„ê¹… ìš©ì´
- ê° ë‹¨ê³„ë³„ ì§„í–‰ ìƒí™© ì¶”ì 
- ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (ì‹¤í–‰ ì‹œê°„, í† í° ì‚¬ìš©ëŸ‰ ë“±)

### í™•ì¥ì„±
- ìƒˆë¡œìš´ ë„êµ¬ ì¶”ê°€ ì‹œ SafeToolLoader í™œìš©
- ì—ì´ì „íŠ¸ í”„ë¡œí•„ í™•ì¥ ê°€ëŠ¥
- ë‹¤ì–‘í•œ LLM í”„ë¡œë°”ì´ë” ì§€ì›